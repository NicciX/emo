

--Integrated Debugger
--- function profiler table

func_time = {
	["decayPass"] = {
		["ST"] = 0,
		["END"] = 0,
		["tot"] = 0,
		["calls"] = 0,
		["longest"] = 0,
	},
	["doLoad"] = {
		["ST"] = 0,
		["END"] = 0,
		["tot"] = 0,
		["calls"] = 0,
		["longest"] = 0,
	},
	["BeaconCheck"] = {
		["ST"] = 0,
		["END"] = 0,
		["tot"] = 0,
		["calls"] = 0,
		["longest"] = 0,
	},
	["BeaconTypeHandler"] = {
		["ST"] = 0,
		["END"] = 0,
		["tot"] = 0,
		["calls"] = 0,
		["longest"] = 0,
	},
	["CDUpdater"] = {
		["ST"] = 0,
		["END"] = 0,
		["tot"] = 0,
		["calls"] = 0,
		["longest"] = 0,
	},
	["RoutineUpdate"] = {
		["ST"] = 0,
		["END"] = 0,
		["tot"] = 0,
		["calls"] = 0,
		["longest"] = 0,
	},
	["MoodFromEmote"] = {
		["ST"] = 0,
		["END"] = 0,
		["tot"] = 0,
		["calls"] = 0,
		["longest"] = 0,
	},
	["MoodUpdate"] = {
		["ST"] = 0,
		["END"] = 0,
		["tot"] = 0,
		["calls"] = 0,
		["longest"] = 0,
	},
	["DoRandom"] = {
		["ST"] = 0,
		["END"] = 0,
		["tot"] = 0,
		["calls"] = 0,
		["longest"] = 0,
	},
	["EmoRange"] = {
		["ST"] = 0,
		["END"] = 0,
		["tot"] = 0,
		["calls"] = 0,
		["longest"] = 0,
	},
	["emoHandler"] = {
		["ST"] = 0,
		["END"] = 0,
		["tot"] = 0,
		["calls"] = 0,
		["longest"] = 0,
	},
	["getWeightedEmote"] = {
		["ST"] = 0,
		["END"] = 0,
		["tot"] = 0,
		["calls"] = 0,
		["longest"] = 0,
	},
	["UseItem"] = {
		["ST"] = 0,
		["END"] = 0,
		["tot"] = 0,
		["calls"] = 0,
		["longest"] = 0,
	},
	["GetGiggly"] = {
		["ST"] = 0,
		["END"] = 0,
		["tot"] = 0,
		["calls"] = 0,
		["longest"] = 0,
	},
	["GiggleGas"] = {
		["ST"] = 0,
		["END"] = 0,
		["tot"] = 0,
		["calls"] = 0,
		["longest"] = 0,
	},
	["EmoCheck"] = {
		["ST"] = 0,
		["END"] = 0,
		["tot"] = 0,
		["calls"] = 0,
		["longest"] = 0,
	},
	["CollisionTracker"] = {
		["ST"] = 0,
		["END"] = 0,
		["tot"] = 0,
		["calls"] = 0,
		["longest"] = 0,
	},
	["Update"] = {
		["ST"] = 0,
		["END"] = 0,
		["tot"] = 0,
		["calls"] = 0,
		["longest"] = 0,
	},
	["UpdateStorageData"] = {
		["ST"] = 0,
		["END"] = 0,
		["tot"] = 0,
		["calls"] = 0,
		["longest"] = 0,
	},
	["GilUpdate"] = {
		["ST"] = 0,
		["END"] = 0,
		["tot"] = 0,
		["calls"] = 0,
		["longest"] = 0,
	},
	["UpdateSitting"] = {
		["ST"] = 0,
		["END"] = 0,
		["tot"] = 0,
		["calls"] = 0,
		["longest"] = 0,
	},
	["UpdateEmoting"] = {
		["ST"] = 0,
		["END"] = 0,
		["tot"] = 0,
		["calls"] = 0,
		["longest"] = 0,
	},
	["MoveToBeacon"] = {
		["ST"] = 0,
		["END"] = 0,
		["tot"] = 0,
		["calls"] = 0,
		["longest"] = 0,
	},
	["EatFood"] = {
		["ST"] = 0,
		["END"] = 0,
		["tot"] = 0,
		["calls"] = 0,
		["longest"] = 0,
	},
	["CheckPeloton"] = {
		["ST"] = 0,
		["END"] = 0,
		["tot"] = 0,
		["calls"] = 0,
		["longest"] = 0,
	},
	["CheckSprint"] = {
		["ST"] = 0,
		["END"] = 0,
		["tot"] = 0,
		["calls"] = 0,
		["longest"] = 0,
	},
	["UpdateHunger"] = {
		["ST"] = 0,
		["END"] = 0,
		["tot"] = 0,
		["calls"] = 0,
		["longest"] = 0,
	},
	["MoodFromEmote"] = {
		["ST"] = 0,
		["END"] = 0,
		["tot"] = 0,
		["calls"] = 0,
		["longest"] = 0,
	},
	["Porting"] = {
		["ST"] = 0,
		["END"] = 0,
		["tot"] = 0,
		["calls"] = 0,
		["longest"] = 0,
	},
	["CheckElixir"] = {
		["ST"] = 0,
		["END"] = 0,
		["tot"] = 0,
		["calls"] = 0,
		["longest"] = 0,
	},
	["FlagsHandler"] = {
		["ST"] = 0,
		["END"] = 0,
		["tot"] = 0,
		["calls"] = 0,
		["longest"] = 0,
	},
	["StatusHandler"] = {
		["ST"] = 0,
		["END"] = 0,
		["tot"] = 0,
		["calls"] = 0,
		["longest"] = 0,
	},
	["UpdateFlags"] = {
		["ST"] = 0,
		["END"] = 0,
		["tot"] = 0,
		["calls"] = 0,
		["longest"] = 0,
	},
	["UpdateStats"] = {
		["ST"] = 0,
		["END"] = 0,
		["tot"] = 0,
		["calls"] = 0,
		["longest"] = 0,
	},
	["onInvoke"] = {
		["ST"] = 0,
		["END"] = 0,
		["tot"] = 0,
		["calls"] = 0,
		["longest"] = 0,
	},
	["distTarget"] = {
		["ST"] = 0,
		["END"] = 0,
		["tot"] = 0,
		["calls"] = 0,
		["longest"] = 0,
	},
	["GetBeaconDistance"] = {
		["ST"] = 0,
		["END"] = 0,
		["tot"] = 0,
		["calls"] = 0,
		["longest"] = 0,
	},
	["CallRoutine"] = {
		["ST"] = 0,
		["END"] = 0,
		["tot"] = 0,
		["calls"] = 0,
		["longest"] = 0,
	},
	["AetherHandler"] = {
		["ST"] = 0,
		["END"] = 0,
		["tot"] = 0,
		["calls"] = 0,
		["longest"] = 0,
	},
	["tokenHandler"] = {
		["ST"] = 0,
		["END"] = 0,
		["tot"] = 0,
		["calls"] = 0,
		["longest"] = 0,
	},
	["Moodle"] = {
		["ST"] = 0,
		["END"] = 0,
		["tot"] = 0,
		["calls"] = 0,
		["longest"] = 0,
	},
	["doEnvironment"] = {
		["ST"] = 0,
		["END"] = 0,
		["tot"] = 0,
		["calls"] = 0,
		["longest"] = 0,
	},
	["CastingEffects"] = {
		["ST"] = 0,
		["END"] = 0,
		["tot"] = 0,
		["calls"] = 0,
		["longest"] = 0,
	},
	["ChattyChop"] = {
		["ST"] = 0,
		["END"] = 0,
		["tot"] = 0,
		["calls"] = 0,
		["longest"] = 0,
	},
	["ChatHandler"] = {
		["ST"] = 0,
		["END"] = 0,
		["tot"] = 0,
		["calls"] = 0,
		["longest"] = 0,
	},
	["shiftTable"] = {
		["ST"] = 0,
		["END"] = 0,
		["tot"] = 0,
		["calls"] = 0,
		["longest"] = 0,
	},
	["EmoGyre"] = {
		["ST"] = 0,
		["END"] = 0,
		["tot"] = 0,
		["calls"] = 0,
		["longest"] = 0,
	},
	["SittingEffects"] = {
		["ST"] = 0,
		["END"] = 0,
		["tot"] = 0,
		["calls"] = 0,
		["longest"] = 0,
	},
	["runGyreMethod"] = {
		["ST"] = 0,
		["END"] = 0,
		["tot"] = 0,
		["calls"] = 0,
		["longest"] = 0,
	},
	["updateAffinity"] = {
		["ST"] = 0,
		["END"] = 0,
		["tot"] = 0,
		["calls"] = 0,
		["longest"] = 0,
	},
	["aspectPass"] = {
		["ST"] = 0,
		["END"] = 0,
		["tot"] = 0,
		["calls"] = 0,
		["longest"] = 0,
	},
	["check_status"] = {
		["ST"] = 0,
		["END"] = 0,
		["tot"] = 0,
		["calls"] = 0,
		["longest"] = 0,
	},
	["GyreLite"] = {
		["ST"] = 0,
		["END"] = 0,
		["tot"] = 0,
		["calls"] = 0,
		["longest"] = 0,
	},
	
	
	
}

filterLog = {
	["0"] = true, -- limited information
	["1"] = true, -- general information
	["2"] = nil, -- function call tracking
	["3"] = nil, -- emotional changes
	["4"] = nil, -- traces
	["5"] = nil, --weather effects
	["6"] = nil, -- zone effects
	["7"] = false, -- Aether Churn
	["8"] = nil, -- outfit effects
	["9"] = false, -- Chat
	["10"] = nil, -- misc.
	["13"] = false, -- Gyre
}

function efficiency()
	local frac = reduce(((profilerTime + totalFuncTime)/(os.time() - loadTime)) * 100, 2)
	return "Efficiency: " .. frac .. "% usage time."
end

function func_track(func)
	local meT = os.time()
	local ct = 0
	local s,e = func_time[func].ST, func_time[func].END
	local n
	local tiS = os.date("%H:%M:%S", s) .. tostring(s - math.floor(s))
	local tiE = os.date("%H:%M:%S", e) .. tostring(e - math.floor(e))
	if type(#func_log) == "number" then
		ct = #func_log + 1
	end
	func_log[ct] = func_log[ct] or {}
	func_log[ct].func = func
	func_log[ct].Start = tiS
	func_log[ct].End = tiE
	
	
	local t = e - s
	if t > 0.0747 then
		if func == "Update" then
			dbgMsg("|FuncTrack| § " .. func .. " func time > 37ms " .. formatTime(t) .. " :: updCall: " .. tostring(currentUpdateCall) .. "", 1)
		else
			dbgMsg("|FuncTrack| § " .. func .. " func time > 37ms " .. formatTime(t) .. "", 1)
		end
	elseif t > 0.777 then
		lock[func] = os.time()
		dbgMsg("|FuncTrack| § " .. func .. " LOCKED for exceeding 0.777ms execution time.. <se.1> ", 1)
	elseif func_time[func].tracking then
		dbgMsg("|FuncTrack| § " .. func .. " ExecTime: " .. formatTime(t) .. "", 1)
	end
	n = formatTime(t)
	func_log[ct].tot = n
	--func_time[func] = func_time[func] or {}
	--func_time[func]["tot"] = func_time[func]["tot"] or 0
	func_time[func].tot = func_time[func].tot + t
	totalFuncTime = totalFuncTime + t
	func_time[func].calls = func_time[func].calls + 1
	if t > func_time[func].longest then
		func_time[func].longest = t
	end
	
	
	if meT - lastUpdate > 30 then
		dbgMsg("._Starting Updater..._.", 2)
		Script.QueueDelay(SQD)
		Script.QueueAction(Update)
	end
	profilerTime = profilerTime + (os.time() - meT)
end

function trim_log()
	if lastTrim then
		if os.time() - lastTrim < 31 then
			if action ~= "sleep" then
				--Game.SendChat("/e EmoBot :: dbg_log :: Overload...Sutting Down! <se.1>")
				--dbgMsg("Overload...Sutting Down! <se.1>")
			end
			if DBG >= 1 then
				if filterLog["13"] then
					Game.SendChat("/e EmoBot :: dbg_log :: Overload... Turning off Gyre Logging... <se.1>")
					filterLog["13"] = nil -- Shut down logging emotional messages
				elseif filterLog["9"] then
					Game.SendChat("/e EmoBot :: dbg_log :: Overload... Turning off ChatHandler Logging... <se.1>")
					filterLog["9"] = nil -- Shut down logging the chat handler
				elseif filterLog["3"] then
					Game.SendChat("/e EmoBot :: dbg_log :: Overload... Turning off Emotional Logging... <se.1>")
					filterLog["3"] = nil -- Shut down logging emotional messages
				
				end
			end
		end
	end
	local t = #dbg_log
	dbg_log = string.sub(dbg_log, 77777, #dbg_log)
	local p = #dbg_log / t * 100
	Game.SendChat("/e EmoBot :: log_tax: " .. p .. "%")
	lastTrim = os.time()
end

function dbgMsg(msg, lvl)
	local ts = os.time()
	if #msg > 250 then
		return
	end
	
	
	local tx = math.floor((ts - math.floor(ts)) * 1000)
	local timestring = os.date("%m-%d-%Y_%H:%M:%S", os.time())
	timestring = timestring .. "." .. tostring(tx) .. " :: "
	local s
	
	if type(DBG) ~= "number" then
		DBG = 1
	end
	--Game.SendChat("/e EmoBot " .. tostring(DBG))
	--if DBG < 0 then
		--CD["global"].dbg = tostring(DBG)
		--return
	--end
	if not lvl then
		lvl = 0
	end
	if not dbgLastcall then
		dbgLastcall = 0
	end
	if os.time() - dbgLastcall > 0.777 then
		if lvl > -1 and lvl < 2 then
			if DBG >= tonumber(lvl) then
				Game.SendChat("/e EmoBot " .. tostring(msg))
				--s = timestring .. "EmoBot " .. tostring(msg) .. "\n"
				--dbg_log = dbg_log .. s
			end
		elseif lvl == DBG then
			if tonumber(lvl) == DBG then
				Game.SendChat("/e EmoBot " .. tostring(msg))
				--s = timestring .. "EmoBot " .. tostring(msg) .. "\n"
				--dbg_log = dbg_log .. s
			end
		else
			--Game.SendChat("/e EmoBot " .. tostring(msg))
			--s = timestring .. "EmoBot " .. tostring(msg) .. "\n"
		end
	end
	if filterLog then
		if filterLog[tostring(lvl)] then
			s = timestring .. "EmoBot " .. tostring(msg) .. "\r"
			dbg_log = dbg_log .. s
		end
		if #dbg_log > 377777 then
			trim_log()
		end
	--else
		--s = timestring .. "EmoBot " .. tostring(msg) .. "\n"
		--dbg_log = dbg_log .. s
	end
	
	dbgLastCall = os.time()
	--if DBG == 1 then
		--Game.SendChat("/e EmoBot " .. tostring(msg))
	--end
end

function SetDBG(args)
	dbgMsg(".SetDBG.", 2)
	if args == "" then
		DBG = -DBG
	else
		DBG = tonumber(args)
		if not DBG then
			DBG = 0
		end
	end
	CD["global"].dbg = tostring(DBG)
	--Script.Storage.all["dbg"] = DBG
	--Script.Storage["global"]["dbg"] = DBG
	Script.SaveStorage()
	dbgMsg("DBG set to [" .. tostring(DBG) .. "].")
end

function tblcompA(a,b)
	if not a.calls or not b.calls then
		return false
	end
	if a.calls < 1 or b.calls < 1 then
		return false
	end
	local x = a.tot / a.calls
	local y = b.tot / b.calls
	return x > y
end

function profiler(filter, mt)
	--local filter, mt = shiftWord(args)
	if not mt then
		mt = "asc"
	elseif #mt == 1 or mt == "" then
		mt = "asc"
	end
	if not filter then
		filter = "longest"
	end
	local tmp = 0
	dbgMsg("≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡", 0)
	dbgMsg("                     Emobot ", 0)
	
	if DBG then
		dbgMsg("Current Version: v" .. emoVer .. "     ☃DBG: " .. DBG .. "☃", 0)
	else
		dbgMsg("☃DBG: nil, now setting value to 0...", 0)
		DBG = 0
	end
	--dbgMsg("rgsA: " .. tostring(rgsA) .. ".", 0)
	--dbgMsg("AethericBuffer: " .. tostring(AethericBuffer) .. ".", 0)
	
	dbgMsg("⁻-⁻-⁻-⁻-⁻-⁻-⁻-⁻-⁻-⁻-⁻-⁻-⁻-⁻", 0)
	dbgMsg("        ------------", 0) -- Functions
	dbgMsg("— — — — — — — — — — — — — — —", 0)
	dbgMsg("filter: " .. tostring(filter) .. ".", 0)
	dbgMsg("sort method: " .. tostring(mt) .. ".", 0)
	if DBG > 0 and #func_log then
		for i=1, #func_log do
			if #filter > 0 and filter ~= "advanced" then
				if filter == func_log[i].func then
					dbgMsg(tostring(func_log[i].stamp), 0)
				end
			elseif filter == "all" then
				dbgMsg(tostring(func_log[i].stamp), 0)
			end
		end
	end
	
	if func_time then
		local fT = {}
		if filter == "longest" then
			for k,v in pairs(func_time) do
				fT[#fT+1] = {k = k, longest = v.longest}
				
			end
			if mt == "desc" or mt == "hilo" then
				table.sort(fT, function(a, b)
					return a.longest > b.longest
				end)
			elseif mt == "asc" or mt == "lohi" then
				table.sort(fT, function(a, b)
					return a.longest < b.longest
				end)
			end
			for k,v in pairs(fT) do
				if v.longest > 1.3 then
					dbgMsg("[" .. k .. "] ƒ" .. tostring(v.k) .. "ƒ :: longest: " .. "Error", 0)
				elseif v.longest == 0 and func_time[v.k].calls == 0 then
					dbgMsg("[" .. k .. "] ƒ" .. tostring(v.k) .. "ƒ :: " .. "No Calls", 0)
				else
					dbgMsg("[" .. k .. "] ƒ" .. tostring(v.k) .. "ƒ :: " .. tostring(formatTime(v.longest)), 0)
				end
			end
		elseif filter == "total" or filter == "tot" then
			for k,v in pairs(func_time) do
				fT[#fT+1] = {k = k, tot = v.tot}
				
			end
			if mt == "desc" or mt == "hilo" then
				table.sort(fT, function(a, b)
					return a.tot > b.tot -- < for ascending sort, > for descending
				end)
			elseif mt == "asc" or mt == "lohi" then
				table.sort(fT, function(a, b)
					return a.tot < b.tot
				end)
			end
			for k,v in pairs(fT) do
				if v.tot > 7777 then
					dbgMsg("[" .. k .. "] ƒ" .. tostring(v.k) .. "ƒ :: tot: " .. "Error", 0)
				elseif v.tot > 0 then
					dbgMsg("[" .. k .. "] ƒ" .. tostring(v.k) .. "ƒ :: " .. tostring(formatTime(v.tot)), 0)
					
				else
					dbgMsg("[" .. k .. "] ƒ" .. tostring(v.k) .. "ƒ :: " .. "No Calls", 0)
				end
			end
		elseif filter == "calls" then
			for k,v in pairs(func_time) do
				fT[#fT+1] = {k = k, calls = v.calls}
			end
			if mt == "desc" or mt == "hilo" then
				table.sort(fT, function(a, b)
					return a.calls > b.calls
				end)
			elseif mt == "asc" or mt == "lohi" then
				table.sort(fT, function(a, b)
					return a.calls < b.calls
				end)
			end
			for k,v in pairs(fT) do
				dbgMsg("[" .. k .. "] ƒ" .. tostring(v.k) .. "ƒ :: " .. " calls: " .. tostring(v.calls), 0)
			end
		elseif filter == "avg" then
			local ag
			for k,v in pairs(func_time) do
				if v.calls > 0 then
					ag = v.tot / v.calls
				else
					ag = 0
				end
				fT[#fT+1] = {k = k, avg = ag}
			end
			if mt == "desc" or mt == "hilo" then
				table.sort(fT, function(a, b)
					return a.avg > b.avg
				end)
			elseif mt == "asc" or mt == "lohi" then
				table.sort(fT, function(a, b)
						return a.avg < b.avg
					end)
			end
			for k,v in pairs(fT) do
				if v.avg > 0 then
					dbgMsg("[" .. k .. "] ƒ" .. tostring(v.k) .. "ƒ :: " .. " avg: " .. formatTime(v.avg), 0)
				else
					dbgMsg("[" .. k .. "] ƒ" .. tostring(v.k) .. "ƒ :: " .. "No Calls", 0)
				end
			end
		end
	end
	dbgMsg("Total Function Time: " .. formatTime(totalFuncTime), 0)
	--local upT = os.date("%H:%M:%S", os.time() - loadTime)
	--dbgMsg("UpTime: " .. tostring(upT), 0)
	
	dbgMsg("Profiler Time: " .. formatTime(profilerTime), 0)
	dbgMsg("Profiler + Function Time: " .. formatTime(profilerTime + totalFuncTime), 0)
	
	dbgMsg("UpTime: " .. formatTime(os.time() - loadTime), 0)

	local eff = efficiency()
	dbgMsg("" .. eff, 0)
end

function dumpInfo(args)
	dbgMsg(".dumpInfo.", 2)
	local what, filter = shiftWord(args)
	if not what or what == "" then
		what = "all"
	end
	--for k,v in pairs(emoState) do
		--Game.SendChat("/e ".. k .. ":" .. v)
	--end
	local map = Game.Player.MapZone
	local tmp, msg
	--local tmp, x = pcall(activity["crafting"])
	--Game.SendChat("/e --- traits ---")
	--for k, v in pairs(CD[playerName].traits) do
		--Game.SendChat("/e [".. k .. "].")
	--end
	
	
	
	--GYRE
	--
	--TRACKING
	--
	--ABCDEFGHIJKLM
	--
	--NOPQRSTUVWXYZ
	--
	--UPDATER
	--
	--ROUTINES
	--
	--PLAYER
	--
	--MAP DATA
	--
	--FUNCTIONS
	--
	--TOKENS
	--
	--BLACK
	--A
	--GREEN
	--
	--YELLOW
	--
	--BLUE
	--
	--RED
	--
	
	dbgMsg("≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡", 0)
	dbgMsg("                     Emobot ", 0)
	
	
	if DBG then
		dbgMsg("Current Version: v" .. emoVer .. "     ☃DBG: " .. DBG .. "☃", 0)
	else
		dbgMsg("☃DBG: nil, now setting value to 0...", 0)
		DBG = 0
	end
	
	
	
	
	
	if what == "all" or what == "updater" then
		--dbgMsg("rgsA: " .. tostring(rgsA) .. ".", 0)
		--dbgMsg("AethericBuffer: " .. tostring(AethericBuffer) .. ".", 0)
		
		dbgMsg("⁻-⁻-⁻-⁻-⁻-⁻-⁻-⁻-⁻-⁻-⁻-⁻-⁻-⁻", 0)
		dbgMsg("        ------------", 0) -- Updater
		dbgMsg("— — — — — — — — — — — — — — —", 0)
		dbgMsg("action: " .. action .. " ", 0)
		dbgMsg("AFK: " .. tostring(AFK) .. " ", 0)
		dbgMsg("updCnt: " .. updCnt .. " ", 0)
		dbgMsg("collisions: ".. tostring(collisions) .. " ", 0)
		dbgMsg("idles: " .. tostring(idles) .. " ", 0)
		dbgMsg("collision %: " .. tostring(math.floor(collisions/updCnt*100)) .. " ", 0)
		dbgMsg("idles %: " .. tostring(math.floor(idles/updCnt*100)) .. " ", 0)
	end
	
	if what == "all" or what == "tokens" or what == "token" or what == "buff" or what == "buffs" then
		--dbgMsg("rgsA: " .. tostring(rgsA) .. ".", 0)
		--dbgMsg("AethericBuffer: " .. tostring(AethericBuffer) .. ".", 0)
		dbgMsg("⁻-⁻-⁻-⁻-⁻-⁻-⁻-⁻-⁻-⁻-⁻-⁻-⁻-⁻", 0)
		dbgMsg("        ------------", 0) -- Tokens
		dbgMsg("— — — — — — — — — — — — — — —", 0)
		
		local tkCnt = 0
		local actCnt = 0
		local map = Game.Player.MapZone
		for k,v in pairs(tokenStack) do
			tkCnt = tkCnt + 1
			if tonumber(k) == map or k == "GEN" then
				actCnt = actCnt + 1
			end
		end
		
		
		
		dbgMsg("Total Tokens: " .. tostring(tkCnt) .. " ", 0)
		dbgMsg("Active Tokens: " .. tostring(actCnt) .. " ", 0)
		
		if filter ~= "simple" then
			dbgMsg("— — — — — Active Tokens — — — — —  ", 0)
			local tk
			actCnt = 0
			local s1,s2
			for k,v in pairs(tokenStack) do
				for a,b in pairs(v) do
					if tonumber(k) == map or k == "GEN" then
						--if tokenStack[k] then
							--if #tokenStack[k][v] > 0 then
								actCnt = actCnt + 1
								if k == "GEN" and not s1 then
									dbgMsg("∇— |——Tokens General——| —∇", 0)
									dbgMsg("○Cnt: " .. tostring(#v) .. " ", 0)
									s1 = true
								elseif not s2 and k ~= "GEN" then
									dbgMsg("∇— |——Tokens Map——| —∇", 0)
									dbgMsg("○Cnt: " .. tostring(#v) .. " ", 0)
									s2 = true
								end
								--tokenStack[map][beaconId].firstCall
								--dbgMsg("Token ID: " .. tostring(v) .. " ", 0)
								tk = b.token
								dbgMsg("Token ID: " .. tostring(a) .. " ", 0)
								dbgMsg("firstCall: " .. tostring(b.firstCall) .. " ", 0)
								
								dbgMsg("lastCall: " .. tostring(b.lastCall) .. " ", 0)
								if tk then
									if tk.type then
										dbgMsg("Type: " .. tostring(tk.type) .. " ", 0)
									else
										dbgMsg("Type: " .. "|Not Defined|" .. " ", 0)
									end
									if tk.interval then
										dbgMsg("interval: " .. tostring(tk.interval) .. " ", 0)
									else
										dbgMsg("interval: " .. "|Not Defined|" .. " ", 0)
									end
									if tk.what then
										dbgMsg("what: " .. tostring(tk.what) .. " ", 0)
									else
										dbgMsg("what: " .. "|Not Defined|" .. " ", 0)
									end
									if tk.falloff then
										dbgMsg("falloff: " .. tostring(formatTime(tk.falloff)) .. " ", 0)
										tmp = tk.falloff - (os.time() - b.firstCall)
										tmp = formatTime(tmp)
										dbgMsg("Falloff in: " .. tostring(tmp) .. " ", 0)
									else
										dbgMsg("falloff: " .. "|Not Defined|" .. " ", 0)
									end
								end
								
								--tokenStack[map][beaconId].typ
								--tokenStack[map][beaconId].lastCall
								--for a,b in pairs(v) do
									--tk = b.token
									
									--tokenStack["GEN"][beaconId].firstCall
									--dbgMsg("Type: " .. tostring(b.type) .. " ", 0)
									--dbgMsg("Rdius: " .. tostring(b.radius) .. " ", 0)
									--dbgMsg("What: " .. tostring(tk.w) .. " ", 0)
								--end
							--end
						--end
					end
				end
			end
			if actCnt == 0 then
				dbgMsg("No active tokens were detected", 0)
			end
		end
	end
	
	--if what == "all" or what == "functions" or what == "function"or what == "func"  then
	
	--end
	
	
	
	if what == "all" or what == "routines" or what == "routine" then
		dbgMsg("                    ", 0)
		dbgMsg("⁻-⁻-⁻-⁻-⁻-⁻-⁻-⁻-⁻-⁻-", 0)
		dbgMsg("   -----Routines-----", 0) -- Routines
		dbgMsg("— — — — — — — — — — — —  ", 0)
		
		local last = os.time() - lastUpdate
		local tmp = math.floor(last*10000)/10000
		local tmpA = os.date("%H:%M:%S", tmp)
		--dbgMsg("testtest: .", 0)
		--tmpA = os.date("%H:%M:%S", lastUpdate)
		--dbgMsg("lastUpdate: " .. tostring(lastUpdate), 0)
		dbgMsg("Time since lastUpdate: " .. tostring(tmpA), 0)
		dbgMsg("routineIdx: " .. tostring(routineIdx), 0)
		dbgMsg("currentRoutineWait: " .. tostring(currentRoutineWait), 0)
		dbgMsg("currentRoutine: " .. tostring(currentRoutine), 0)
	end
	
	if what == "all" or what == "player" then
		dbgMsg("                    ", 0)
		dbgMsg("⁻-⁻-⁻-⁻-⁻-⁻-⁻-⁻-⁻-⁻-", 0)
		dbgMsg("   -----Player-----", 0) -- Player
		dbgMsg("— — — — — — — — — — — —  ", 0)
		
		dbgMsg("gilBuff: " .. tostring(gilBuff) .. ".", 0)
		dbgMsg("currentGil: " .. tostring(currentGil) .. ".", 0)
		dbgMsg("lastGil: " .. tostring(lastGil) .. ".", 0)
		currentGil = currentGil or 0
		lastGil = lastGil or 0
		local diff = currentGil - lastGil
		dbgMsg("difference: " .. tostring(diff) .. ".", 0)
		local s = Game.Player.Entity.Job.Name
		s = s:lower():gsub("^%l", string.upper)
		if s then
			dbgMsg("Job: " .. tostring(s) .. ".", 0)
		end
		
		
		dbgMsg("Race ".. tostring(playerRace) .. ".", 0)
		dbgMsg("playerSubRace ".. tostring(playerSubRace) .. ".", 0)
		dbgMsg("playerGuardian ".. tostring(playerGuardian) .. ".", 0)
		dbgMsg("playerCity ".. tostring(playerCity) .. ".", 0)
		dbgMsg("playerRank ".. tostring(playerRank) .. ".", 0)
		dbgMsg("genderToken ".. tostring(genderToken) .. ".", 0)
		dbgMsg("playerNameday ".. tostring(playerNameday) .. ".", 0)
		
		
		if IsBusy("quick") then
			dbgMsg("Is Busy? " .. tostring(IsBusy("quick")) .. ".", 0)
		else
			dbgMsg("Is Busy?  No.", 0)
		end
		
		--[[
		[1] = true, -- 1 (0) -- NormalConditions
		[2] = false, -- 3 (1) -- Emoting
		[3] = false, -- 9 (2)  -- CarryingObject
		[4] = false, -- 11 (3)  -- InThatPosition - sitting or dozing
		[5] = false, -- 27 (4)  -- Casting
		[6] = false, -- 36 (5)  -- InDeulingArea
		[7] = false, -- 45 (6)  -- BetweenAreas - can be used to determine if porting
		[8] = false, -- 46 (7)  -- Stealthed
		[9] = false, -- 48 (8)  -- Jumping
		[10] = false, -- 49 (9)  -- AutoRunActive
		[11] = false, -- 50 (10)  -- OccupiedSummoningBell
		[12] = false, -- 51 (11)  -- BetweenAreas51
		[13] = false, -- 52 (12)  -- SystemError
		[14] = false, -- 53 (13)  -- LoggingOut
		[15] = false, -- 54 (14)  -- ConditionLocation
		[16] = false, -- 65 (15)  -- Carrying Item
		[17] = false, -- 68 (16)  -- Transformed
		[18] = false, -- 70 (17)  -- BeingMoved
		[19] = false, -- 77 (18)  -- InFlight
		[20] = false, -- 90 (19)  -- RolePlaying
		[21] = false, -- 92 (20)  -- ReadyingVisitOtherWorld
		[22] = false, -- 93 (21)  -- WaitingToVisitOtherWorld
		[23] = false, -- 94 (22)  -- UsingParasol
		[24] = false, -- 97 (23)  -- Disguised
		[25] = false, -- 100 (24)  -- EditingPortrait
		]]--
		
		
		dbgMsg("Autonrun On? " .. tostring(flags[10]) .. ".", 0)
		dbgMsg("Is Jumping? " .. tostring(flags[9]) .. ".", 0)
		dbgMsg("Is Casting? " .. tostring(flags[5]) .. ".", 0)
		dbgMsg("Is Emoting? " .. tostring(IsEmoting) .. ".", 0)
		dbgMsg("Is Emoting (flag)? " .. tostring(flags[2]) .. ".", 0)
		dbgMsg("Is Swimming? " .. tostring(Game.Player.Swimming) .. ".", 0)
		dbgMsg("Is Diving? " .. tostring(Game.Player.Diving) .. ".", 0)
		dbgMsg("Is Porting? " .. tostring(IsPorting) .. ".", 0)
		dbgMsg("Is Sitting? " .. tostring(IsSitting) .. ".", 0)
		dbgMsg("Is Carrying Object? " .. tostring(flags[3]) .. ".", 0)
		dbgMsg("Alive? ".. tostring(Game.Player.Entity.Alive) .. ".", 0)
		dbgMsg("Is Sitting(flag)? " .. tostring(flags[4]) .. ".", 0)
		dbgMsg("AethericBuffer: " .. tostring(AethericBuffer) .. ".", 0)
		dbgMsg("Peloton Active? " .. tostring(pelotonActive) .. ".", 0)
		dbgMsg("Sprint Active? " .. tostring(sprintActive) .. ".", 0)
		
		dbgMsg("tempComfortFactor: " .. tostring(tempComfortFactor) .. ".", 0)
		
	end
	
	if what == "all" or what == "map" or what == "mapdata" or what == "map data" or what == "beacon" or what == "beacons" or what == "bacon" then
		dbgMsg("                    ", 0)
		dbgMsg("⁻-⁻-⁻-⁻-⁻-⁻-⁻-⁻-⁻-⁻-", 0)
		dbgMsg("   ---Map Data---", 0)
		dbgMsg("— — — — — — — — — — — —  ", 0)
		
		dbgMsg("Current World: [".. Game.Player.CurrentWorld .. "].", 0)
		dbgMsg("Current Weather: [".. Game.Weather.Name .. "].", 0)
		dbgMsg("Current Zone: [".. Game.Player.MapZone .. "].", 0)
		dbgMsg("tempComfortFactor: " .. tostring(tempComfortFactor) .. ".", 0)
		
		if zones[map] then
			dbgMsg("Current Zone Name: [".. tostring(zones[map].name) .. "].", 0)
			dbgMsg("Current Zone Area: [".. tostring(zones[map].cont) .. "].", 0)
		end
		
		if lastBeaconCD and lastBeaconTime > 0 then
			--
			tmp = lastBeaconTime - (os.time() - lastBeaconCD)
			if tmp > 0 then
				tmp = formatTime(tmp)
			else
				tmp = 0
			end
			-- os.time() - v.cooldown > lastBeaconTime
			--if tmp > 0 then
				dbgMsg("Beacon Cooldown Remaining: " .. tostring(tmp) .. ".", 1)
			--end
		end
		if lastBeacon then
			dbgMsg("Current Beacon: " .. lastBeacon .. ".", 1)
		end
		if lastBeaconDistance then
			dbgMsg("lastBeaconDistance: " .. tostring(lastBeaconDistance) .. ".", 1)
		end
		if currentBeaconDistance then
			dbgMsg("currentBeaconDistance: " .. tostring(currentBeaconDistance) .. ".", 1)
		end
	end
	
	if what == "all" or what == "outfits" or what == "outfit" then
		dbgMsg("                    ", 0)
		dbgMsg("⁻-⁻-⁻-⁻-⁻-⁻-⁻-⁻-⁻-⁻-⁻-⁻-⁻-⁻", 0)
		dbgMsg("   ∇→-----  -----←∇", 0) -- Outfits
		dbgMsg("— — — — — — — — — — — — — — —  ", 0)
		dbgMsg("Current Outfit: " .. tostring(currentOutfit) .. ".", 0)
		CD[playerName].outfits = CD[playerName].outfits or {}
		dbgMsg("Saved Current Outfit: " .. tostring(CD[playerName].outfits[currentOutfit]) .. ".", 0)
		if CD[playerName].outfits then
			if CD[playerName].outfits[currentOutfit] then
				dbgMsg("Outfit Job: " .. tostring(CD[playerName].outfits[currentOutfit]["job"]) .. ".", 0)
			end
		end
		
		if filter == "listonly" then
			dbgMsg("— — — — Saved Outfits — — — —  ", 0)
			if #CD[playerName].outfits > 0 then
				for k,v in pairs(CD[playerName].outfits) do
					dbgMsg("" .. k .. "", 0)
				end
			end
		else
			if CD[playerName].outfits[currentOutfit] then
				if CD[playerName].outfits[currentOutfit]["30"] then
					dbgMsg("✓Panties Set :" .. tostring(CD[playerName].outfits[currentOutfit]["30"]) .. ".", 0)
					if filter == "advanced" then
						dbgMsg("Current? :: " .. tostring(currentOutfitSet["30"]) .. ".", 0)
					end
				else
					dbgMsg("Panties Not Set:", 0)	
				end
				if CD[playerName].outfits[currentOutfit]["31"] then
					dbgMsg("✓Bra Set :" .. tostring(CD[playerName].outfits[currentOutfit]["31"]) .. ".", 0)
					if filter == "advanced" then
						dbgMsg("Current? :: " .. tostring(currentOutfitSet["31"]) .. ".", 0)
					end
				else
					dbgMsg("Bra Not Set:", 0)
				end
				if CD[playerName].outfits[currentOutfit]["32"] then
					dbgMsg("✓Nails Set :" .. tostring(CD[playerName].outfits[currentOutfit]["32"]) .. ".", 0)
					if filter == "advanced" then
						dbgMsg("Current? :: " .. tostring(currentOutfitSet["32"]) .. ".", 0)
					end
				else
					dbgMsg("Nails Not Set:", 0)
				end
				if CD[playerName].outfits[currentOutfit]["glasses"] then
					dbgMsg("✓Facewear Set :" .. tostring(CD[playerName].outfits[currentOutfit]["glasses"]) .. ".", 0)
				else
					dbgMsg("Facewear Not Set:", 0)
				end
				if CD[playerName].outfits[currentOutfit]["temp"] then
					dbgMsg("✓Current Outfit Environment: " .. tostring(CD[playerName].outfits[currentOutfit]["temp"]) .. ".", 0)
				else
					dbgMsg("Outfit Environment Not Set:", 0)
				end
			end
			if filter == "supersimple" then
				dbgMsg("♦ — ♦ — ♦ — ♦ — ♦ — ♦ — ♦", 0)
			else
			dbgMsg("— — — — — S L O T S — — — — —  ", 0)
			
				if type(CD[playerName].outfits[currentOutfit]) == "table" then
					dbgMsg("∇Current Outfit Type(s)∇", 0)					
					if type(CD[playerName].outfits[currentOutfit]["type"]) == "table" then
						for k,y in pairs(CD[playerName].outfits[currentOutfit]["type"]) do
							dbgMsg("" .. k, 0)
						end
					end
					if filter ~= "simple" then
						--CD[playerName].outfits[currentOutfit].weapon
						for k, v in pairs(gearSlotName) do
							tmp = string.lower(v) .. "Name"
							msg = tostring(CD[playerName]["outfits"][currentOutfit][tmp])
							dbgMsg("" .. v .. " :: " .. msg .. ".", 0)
						--for k,v in pairs(CD[playerName]["outfits"][currentOutfit]) do
							--if gearSlotName[k] then
								--dbgMsg("" .. k .. " :: " .. v .. ".", 0)
								if filter == "advanced" then
									dbgMsg("Current? :: " .. tostring(currentOutfitSet[k]) .. ".", 0)
								end
								--currentOutfitSet
							--end
						end
					end
				end
			end
		end
		
		--dbgMsg("Current Outfit Type: " .. tostring(currentOutfit) .. ".", 0)
		
	end	
	
	if what == "all" or what == "emotions" or what == "emotion" then
		dbgMsg("                    ", 0)
		dbgMsg("⁻-⁻-⁻-⁻-⁻-⁻-⁻-⁻-⁻-⁻-", 0)
		dbgMsg("   -----Emotions-----", 0)
		dbgMsg("— — — — — — — — — — — —  ", 0)
		tmp = (rndTime + rndWait) - os.time()
		tmpA = os.date("%H:%M:%S", tmp)
		dbgMsg("Last Update: ".. formatTime(tmp), 0)
		dbgMsg("os.time: " .. formatTime(os.time() - tZone), 0)
		dbgMsg("rnd? ".. tostring(rnd) .. ".", 0)
		dbgMsg("rndTime: " .. formatTime(rndTime - tZone), 0)
		dbgMsg("rndWait: " .. formatTime(rndWait), 0)
		dbgMsg("domiMood: " .. tostring(domiMood) .. ".", 0)
		dbgMsg("lastEmote: " .. tostring(lastEmote) .. ".", 0)
		dbgMsg("emotionsRange: " .. tostring(emotionsRange) .. ".", 0) -- deprecated 0.6.19
		dbgMsg("emotionsTotal: " .. tostring(emotionsTotal) .. ".", 0)
					--emotionsTotal = tot
		
			
		if tmp > 0 and rnd then
			--tmpA = tostring(math.floor(rndWait*100)/100)
			dbgMsg("Next random emote scheduled in ~" .. tmpA .. ".", 1)
		else
			dbgMsg("No random emotes are scheduled.", 1)
		end
	end
	
	if what == "all" or what == "quirks" or what == "quirk" then
		dbgMsg("                    ", 0)
		dbgMsg("⁻-⁻-⁻-⁻-⁻-⁻-⁻-⁻-⁻-⁻-", 0)
		dbgMsg("   -------Quirks-------", 0)
		dbgMsg("— — — — — — — — — — — —  ", 0)
		--tmp = (rndTime + rndWait) - os.time()
		--tmpA = os.date("%H:%M:%S", tmp)
		if quirkPass then
			dbgMsg("Last Quirk Pass: 2.", 0)
		else
			dbgMsg("Last Quirk Pass: 1.", 0)
		end
		dbgMsg("activeQuirk? " .. tostring(activeQuirk), 0)
		
		dbgMsg("— — — —  I N F O  — — — —  ", 0)
		
		
		for k,v in pairs(CD[playerName].quirks) do
			dbgMsg("Quirk: " .. tostring(k), 0)
			dbgMsg(k .. ".charge " .. tostring(v.charge), 0)
			if v.last then
				dbgMsg(k .. ".last " .. tostring(formatTime(v.last - 3600*6)), 0)
			end
			if v.last then
				dbgMsg("CD remaining: " .. tostring(formatTime(os.time() - v.last)) .. ".",0)
				dbgMsg("Time until Falloff: " .. tostring(formatTime(math.floor(quirks[k].falloff - (os.time() - v.last)))) .. ".",0)
			end
			dbgMsg("quirks[\"" .. k .. "\"].cd " .. tostring(quirks[k].cd), 0)
			dbgMsg("quirks[\"" .. k .. "\"].falloff " .. tostring(quirks[k].falloff), 0)
			
		end
		
		
		
		
		
	end
	--Game.SendChat("/e emote[3]: " .. tostring(emTab[3]) .. ".")
	
	
end


return {func_time, dumpInfo, SetDBG, dbgMsg, trim_log, func_track, efficiency, filterLog, profiler}